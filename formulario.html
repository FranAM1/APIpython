<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Residuos peligrosos en madrid</title>
    <style>
        *{
            box-sizing: border-box;
        }
        body{
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .gif{
            width: 100%;
            height: 100%;
            position: absolute;
            display: none;
            z-index: 1;
        }
    </style>
</head>
<body>
    <img class="gif" src="gifpensar.gif" />
    <header>
        <h1>Residuos peligrosos en madrid</h1>
        <label for="municipio">Municipio: </label>
        <input type="text" id="municipio" placeholder="Municipio">
        
    </header>
    <main>
        <section>
            <h2> Calles y actividades de ese municipio </h2>
            <button onclick="send()">Mostrar informaci√≥n</button>
            <p id="residuos"></p>
        </section>
        <section>
            <h2> Porcentaje de residuos en el municipio respecto todo Madrid </h2>
            <button onclick="calcPercentage()">Calcular porcentaje</button>
            <p id="percentage"> </p>
        </section>
    </main>
   
</body>
    <script>
        const MY_API_URL = "http://localhost:8000/residuos"

        async function send() {
            const municipio = document.getElementById("municipio").value;
           
            const json = {
                  municipio: municipio,
            };
 
            const response = await fetch(MY_API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(json),
            });

            const data = await response.json();
            console.log(data);
            printResiduos(data);
        }

        async function calcPercentage(){
            const municipio = document.getElementById("municipio").value;
           
            const json = {
                  municipio: municipio,
            };

            const response = await fetch(MY_API_URL+"/percentage", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(json),
            });

            const data = await response.json();
            console.log(data);
            printPercentage(data);
        }

        async function printResiduos(arrayAPI){
            let residuos = document.getElementById("residuos");
            residuos.innerHTML = "";

            if (arrayAPI.length == 0) {
                residuos.innerHTML = "No hay residuos en este municipio";
            }else{
                for (let i = 0; i < arrayAPI.length; i++) {
                    const element = arrayAPI[i];
                    residuos.innerHTML += "<b>Direccion: </b> "+element.DIRECCION + " | <b> Actividad: </b>"+element.ACTIVIDAD + "<br><br>";
                }
            }
            
        }

        async function printPercentage(percentage){
            let percentageHTML = document.getElementById("percentage");
            percentageHTML.innerHTML = "";

            percentageHTML.innerHTML = "<b>Porcentaje de residuos peligrosos respecto a todo Madrid: </b>"+percentage*100+"%";
        }
       
    </script>
</html>